<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeRuaD - Your Favorite Music Platform</title>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/favourite.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
</head>
<body class="text-light">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../index.html">NeRuaD</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#favNav" aria-controls="favNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="favNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link" href="../../index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="favourite.html">Favourites</a></li>
                    <li class="nav-item"><a class="nav-link" href="profile.html">Profile</a></li>
                </ul>
                
                <div class="btn-group">
                    <a class="btn btn-outline-secondary text-light" href="login.html">Login</a>
                    <a class="btn btn-warning" href="register.html">Sign Up</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="content" style="min-height: calc(100vh - 200px); padding-bottom: 90px;">
        <div class="container" style="max-width: 920px;">
            <h2 class="mb-3">My Favourite Tracks</h2>
            
            
            
            <div id="favouritesGrid" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"></div>
        </div>
    </div>
    <footer class="bg-dark text-light border-top border-secondary mt-auto">
        <div class="container py-4">
            <div class="row g-3">
                <div class="col-12 col-md-4">
                    <h5>NeRuaD</h5>
                    <div id="datetime-container"></div>
                    <div class="feature-box">
                        <button id="open-popup-btn" class="feature-btn">Subscribe to our Newsletter</button>
                    </div>
        
                    <div class="feature-box">
                        <button id="change-bg-btn" class="feature-btn">Change Background Color</button>
                    </div>
                </div>
                <div class="col-12 col-md-8">
                    <div class="accordion-item">
                        <button class="accordion-header w-100">How do I create a playlist?</button>
                        <div class="accordion-content"><p>To create a playlist, navigate to the 'My Playlists' section and click the 'New Playlist' button. You can then add tracks by searching for them and clicking the 'Add to Playlist' icon.</p></div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header w-100">Can I use this platform offline?</button>
                        <div class="accordion-content"><p>Offline listening is a premium feature. Subscribers can download their favorite tracks and playlists to listen without an internet connection.</p></div>
                    </div>
                    <div class="accordion-item">
                        <button class="accordion-header w-100">How is my data protected?</button>
                        <div class="accordion-content"><p>We take your privacy seriously. All user data is encrypted and stored securely. We do not share your personal information with third parties without your consent. For more details, please review our Privacy Policy.</p></div>
                    </div>
                </div>
            </div>

            <div id="popup-overlay">
                <div class="popup-content">
                    <span id="close-popup-btn">&times;</span>
                    <h3>Subscribe Now</h3>
                    <p>Get the latest music news and updates directly in your inbox.</p>
                    <form>
                        <input type="email" placeholder="Enter your email" required>
                        <button type="submit" class="feature-btn">Subscribe</button>
                    </form>
                </div>
            </div>
            <div class="pt-3">Ruslan Bolatbekuly, Nurkhan Orazbay</div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/favorites-manager.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/shared-ux.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // Check if user is logged in
        if (!window.FavoritesManager || !window.FavoritesManager.isUserLoggedIn()) {
            // User not logged in - show message
            var grid = document.getElementById('favouritesGrid');
            var emptyWrap = document.createElement('div');
            emptyWrap.className = 'text-center text-secondary py-5';
            emptyWrap.innerHTML = `
                <div class="mb-3">
                    <i style="font-size: 3rem; color: #666;">ðŸ”’</i>
                </div>
                <h4>Login Required</h4>
                <p>Please login to view your favorite tracks</p>
                <a href="login.html" class="btn btn-warning">Login</a>
                <a href="register.html" class="btn btn-outline-secondary ms-2">Sign Up</a>
            `;
            grid.parentNode.appendChild(emptyWrap);
            return;
        }

        // Get user's favorites
        var list = window.FavoritesManager.readUserFavorites();
        var grid = document.getElementById('favouritesGrid');
        grid.innerHTML = '';
        
        if (!list.length) {
            var emptyWrap = document.createElement('div');
            emptyWrap.className = 'text-center text-secondary py-5';
            emptyWrap.innerHTML = `
                <div class="mb-3">
                    <i class="fas fa-heart" style="font-size: 3rem; color: #666;"></i>
                </div>
                <h4>No favourites yet</h4>
                <p>Start adding your favorite tracks from the home page!</p>
                <a href="../../index.html" class="btn btn-warning">Browse Music</a>
            `;
            grid.parentNode.appendChild(emptyWrap);
            return;
        }
        
        // Show notification for loaded favorites
        if (window.showNotification) {
            showNotification('Favorites Loaded', `Found ${list.length} favorite track(s)`, 'info', 2000);
        }
        
        list.forEach(function (item, index) {
            var col = document.createElement('div');
            col.className = 'col';
            var card = document.createElement('div');
            card.className = 'card h-100 bg-dark border-secondary text-light';
            card.setAttribute('data-title', item.title);
            
            var img = document.createElement('img');
            img.className = 'card-img-top';
            img.src = item.img.replace('frontend/src/img/', '../src/img/');
            img.alt = item.title;
            
            var body = document.createElement('div');
            body.className = 'card-body d-flex flex-column';
            
            var p = document.createElement('p');
            p.className = 'card-text mb-2';
            p.textContent = item.title;
            
            // Add copy button for track title
            var copyBtn = document.createElement('button');
            copyBtn.className = 'copy-btn btn btn-sm btn-outline-secondary';
            copyBtn.setAttribute('data-copy-text', item.title);
            copyBtn.innerHTML = '<span class="copy-icon">ðŸ“‹</span> <span class="copy-text">Copy</span>';
            
            // Add remove button
            var removeBtn = document.createElement('button');
            removeBtn.className = 'btn btn-sm btn-danger mt-auto';
            removeBtn.innerHTML = ' &#128465;&#65039';
            removeBtn.onclick = function() {
                removeFromFavorites(item.id);
            };
            
            body.appendChild(p);
            body.appendChild(copyBtn);
            body.appendChild(removeBtn);
            card.appendChild(img);
            card.appendChild(body);
            col.appendChild(card);
            grid.appendChild(col);
        });
        
        // Initialize copy buttons after DOM is updated
        setTimeout(function() {
            if (window.initializeCopyToClipboard) {
                initializeCopyToClipboard();
            }
        }, 100);
    });
    
    function removeFromFavorites(itemId) {
        if (!window.FavoritesManager) return;
        
        // Remove from user's favorites
        const success = window.FavoritesManager.removeFromUserFavorites(itemId);
        
        if (success) {
            // Show notification
            if (window.showNotification) {
                showNotification('Removed', 'Track removed from favorites', 'success', 2000);
            }
            
            // Reload the page to update the display
            setTimeout(function() {
                location.reload();
            }, 1000);
        }
    }
    </script>
</body>
</html>